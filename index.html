<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NGG Jewelry Price Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #ffd700, #ffb347);
            color: #333;
            padding: 30px;
            text-align: center;
            position: relative;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.3)"/><circle cx="80" cy="40" r="1.5" fill="rgba(255,255,255,0.3)"/><circle cx="40" cy="70" r="1" fill="rgba(255,255,255,0.3)"/></svg>');
            opacity: 0.7;
        }
        
        .header h1 {
            font-size: 2.2rem;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 1;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.8;
            position: relative;
            z-index: 1;
        }
        
        .content {
            padding: 30px;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 30px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 5px;
        }
        
        .tab-button {
            flex: 1;
            padding: 15px 20px;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            color: #666;
        }
        
        .tab-button.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }
        
        label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }
        
        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }
        
        .calculate-btn {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            margin: 20px 0;
        }
        
        .calculate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(40, 167, 69, 0.3);
        }

        .save-btn {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            margin: 10px 0;
        }
        
        .save-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 123, 255, 0.3);
        }

        .save-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .result {
            background: linear-gradient(135deg, #e8f5e8, #f0fff4);
            border: 2px solid #28a745;
            padding: 25px;
            border-radius: 15px;
            margin-top: 20px;
            display: none;
        }
        
        .result.show {
            display: block;
            animation: slideIn 0.5s ease;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-50px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .result h3 {
            color: #28a745;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }
        
        .calculation-details {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            border-left: 4px solid #667eea;
        }
        
        .calculation-step {
            margin: 8px 0;
            color: #666;
        }
        
        .final-price {
            font-size: 1.8rem;
            font-weight: bold;
            color: #28a745;
            text-align: center;
            margin-top: 15px;
            padding: 15px;
            background: rgba(40, 167, 69, 0.1);
            border-radius: 10px;
        }
        
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            color: #856404;
        }
        
        .info-box {
            background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
            border-left: 4px solid #2196f3;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .info-box h4 {
            color: #1976d2;
            margin-bottom: 10px;
        }
        
        .info-box ul {
            margin-left: 20px;
        }
        
        .info-box li {
            margin: 5px 0;
            color: #555;
        }

        .success-message {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            border: 2px solid #28a745;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            color: #155724;
            display: none;
        }

        .error-message {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            border: 2px solid #dc3545;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            color: #721c24;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üíé NGG Jewelry Calculator</h1>
            <p>‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏±‡∏ö‡∏ã‡∏∑‡πâ‡∏≠‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</p>
        </div>
        
        <div class="content">
            <div class="tabs">
                <button class="tab-button active" onclick="switchTab('buyback')">‡∏£‡∏±‡∏ö‡∏ã‡∏∑‡πâ‡∏≠‡∏Ñ‡∏∑‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
                <button class="tab-button" onclick="switchTab('exchange')">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
            </div>
            
            <!-- Buyback Tab -->
            <div id="buyback" class="tab-content active">
                <div class="info-box">
                    <h4>üìã ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏ã‡∏∑‡πâ‡∏≠‡∏Ñ‡∏∑‡∏ô</h4>
                    <ul>
                        <li><strong>Jewelry < 20,000 ‡∏ö‡∏≤‡∏ó:</strong> ‡∏´‡∏±‡∏Å 50%</li>
                        <li><strong>Jewelry ‚â• 20,000 ‡∏ö‡∏≤‡∏ó:</strong> ‡∏´‡∏±‡∏Å 30%</li>
                        <li><strong>‡∏ó‡∏≠‡∏á K (‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô):</strong> 1,300 ‡∏ö‡∏≤‡∏ó/‡∏Å‡∏£‡∏±‡∏°</li>
                        <li><strong>‡∏ó‡∏≠‡∏á K (‡∏°‡∏µ‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô):</strong> 1,500 ‡∏ö‡∏≤‡∏ó/‡∏Å‡∏£‡∏±‡∏°</li>
                    </ul>
                </div>

                <!-- Branch Selection -->
                <div class="form-group">
                    <label>üè¢ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤</label>
                    <select id="branch" required>
                        <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤ --</option>
                        <option value="Central Ayutthaya">Central Ayutthaya</option>
                        <option value="Central Sriracha">Central Sriracha</option>
                        <option value="Future Park Rangsit">Future Park Rangsit</option>
                        <option value="Central Chiangmai">Central Chiangmai</option>
                        <option value="Central World">Central World</option>
                        <option value="Central World Kiosk">Central World Kiosk</option>
                        <option value="Jungceylon">Jungceylon</option>
                        <option value="Central Rama 2">Central Rama 2</option>
                        <option value="Central Nakhon Sawan">Central Nakhon Sawan</option>
                        <option value="Central Nakhon Pathom">Central Nakhon Pathom</option>
                        <option value="Central Phuket">Central Phuket</option>
                        <option value="Central Pattaya">Central Pattaya</option>
                        <option value="Central Rama 9">Central Rama 9</option>
                    </select>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
                        <select id="productType" onchange="toggleProductOptions()">
                            <option value="diamond">Jewelry</option>
                            <option value="gold">‡∏ó‡∏≠‡∏á K</option>
                        </select>
                    </div>
                </div>
                
                <!-- Diamond/Gem Options -->
                <div id="diamondOptions">
                    <div class="form-group">
                        <label>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡∏≠‡∏ô‡∏ã‡∏∑‡πâ‡∏≠ (‡∏ö‡∏≤‡∏ó)</label>
                        <input type="number" id="originalPrice" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">
                    </div>
                </div>
                
                <!-- Gold Options -->
                <div id="goldOptions" style="display: none;">
                    <div class="form-row">
                        <div class="form-group">
                            <label>‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏ó‡∏≠‡∏á (‡∏Å‡∏£‡∏±‡∏°)</label>
                            <input type="number" id="goldWeight" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å" step="0.01">
                        </div>
                        <div class="form-group">
                            <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô</label>
                            <select id="goldWarranty">
                                <option value="with">‡∏°‡∏µ‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô NGG</option>
                                <option value="without">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>‡∏™‡∏†‡∏≤‡∏û‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
                        <select id="condition">
                            <option value="A">‡πÄ‡∏Å‡∏£‡∏î A (95% ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ)</option>
                            <option value="B">‡πÄ‡∏Å‡∏£‡∏î B (70.1% - 94.9%)</option>
                            <option value="C">‡πÄ‡∏Å‡∏£‡∏î C (‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ 70%)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>‡∏°‡∏µ‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô NGG ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà</label>
                        <select id="warranty">
                            <option value="yes">‡∏°‡∏µ</option>
                            <option value="no">‡πÑ‡∏°‡πà‡∏°‡∏µ</option>
                        </select>
                    </div>
                </div>

                <!-- Customer Information -->
                <div class="info-box">
                    <h4>üë§ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å)</h4>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</label>
                        <input type="text" id="customerName" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤">
                    </div>
                    <div class="form-group">
                        <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                        <input type="tel" id="customerPhone" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå">
                    </div>
                </div>
                
                <button class="calculate-btn" onclick="calculatePrice()">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏Ñ‡∏≤</button>
                
                <div id="result" class="result">
                    <h3>üí∞ ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</h3>
                    <div id="calculationDetails" class="calculation-details">
                        <div id="calculationSteps"></div>
                        <div id="finalPrice" class="final-price"></div>
                    </div>
                    <button class="save-btn" id="saveBtn" onclick="saveToGoogleSheets()" disabled>
                        üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á Google Sheets
                    </button>
                </div>

                <div id="successMessage" class="success-message">
                    ‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß!
                </div>

                <div id="errorMessage" class="error-message">
                    ‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                </div>
            </div>
            
            <!-- Exchange Tab -->
            <div id="exchange" class="tab-content">
                <div class="info-box">
                    <h4>üîÑ ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h4>
                    <ul>
                        <li>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏î‡∏¥‡∏°‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏ã‡∏∑‡πâ‡∏≠‡∏Ñ‡∏∑‡∏ô</li>
                        <li>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏Ñ‡πà‡∏≤‡πÅ‡∏õ‡∏£‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏°‡πà 500 ‡∏ö‡∏≤‡∏ó/‡∏ä‡∏¥‡πâ‡∏ô</li>
                        <li>‡∏´‡∏≤‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤ ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á</li>
                        <li>‡∏´‡∏≤‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á</li>
                    </ul>
                </div>

                <!-- Branch Selection for Exchange -->
                <div class="form-group">
                    <label>üè¢ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤</label>
                    <select id="exchangeBranch" required>
                        <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤ --</option>
                        <option value="Central Ayutthaya">Central Ayutthaya</option>
                        <option value="Central Sriracha">Central Sriracha</option>
                        <option value="Future Park Rangsit">Future Park Rangsit</option>
                        <option value="Central Chiangmai">Central Chiangmai</option>
                        <option value="Central World">Central World</option>
                        <option value="Central World Kiosk">Central World Kiosk</option>
                        <option value="Jungceylon">Jungceylon</option>
                        <option value="Central Rama 2">Central Rama 2</option>
                        <option value="Central Nakhon Sawan">Central Nakhon Sawan</option>
                        <option value="Central Nakhon Pathom">Central Nakhon Pathom</option>
                        <option value="Central Phuket">Central Phuket</option>
                        <option value="Central Pattaya">Central Pattaya</option>
                        <option value="Central Rama 9">Central Rama 9</option>
                    </select>
                </div>

                <!-- Old Product Section -->
                <div class="info-box">
                    <h4>üì¶ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô</h4>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏î‡∏¥‡∏°</label>
                        <select id="oldProductType" onchange="toggleOldProductOptions()">
                            <option value="diamond">Jewelry</option>
                            <option value="gold">‡∏ó‡∏≠‡∏á K</option>
                        </select>
                    </div>
                </div>

                <!-- Old Diamond/Gem Options -->
                <div id="oldDiamondOptions">
                    <div class="form-group">
                        <label>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏î‡∏¥‡∏°‡∏ï‡∏≠‡∏ô‡∏ã‡∏∑‡πâ‡∏≠ (‡∏ö‡∏≤‡∏ó)</label>
                        <input type="number" id="oldOriginalPrice" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏î‡∏¥‡∏°">
                    </div>
                </div>

                <!-- Old Gold Options -->
                <div id="oldGoldOptions" style="display: none;">
                    <div class="form-row">
                        <div class="form-group">
                            <label>‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏ó‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏° (‡∏Å‡∏£‡∏±‡∏°)</label>
                            <input type="number" id="oldGoldWeight" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡πÄ‡∏î‡∏¥‡∏°" step="0.01">
                        </div>
                        <div class="form-group">
                            <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏ó‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°</label>
                            <select id="oldGoldWarranty">
                                <option value="with">‡∏°‡∏µ‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô NGG</option>
                                <option value="without">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>‡∏™‡∏†‡∏≤‡∏û‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏î‡∏¥‡∏°</label>
                        <select id="oldCondition">
                            <option value="A">‡πÄ‡∏Å‡∏£‡∏î A (95% ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ)</option>
                            <option value="B">‡πÄ‡∏Å‡∏£‡∏î B (70.1% - 94.9%)</option>
                            <option value="C">‡πÄ‡∏Å‡∏£‡∏î C (‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ 70%)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>‡∏°‡∏µ‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô NGG ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏î‡∏¥‡∏°</label>
                        <select id="oldWarranty">
                            <option value="yes">‡∏°‡∏µ</option>
                            <option value="no">‡πÑ‡∏°‡πà‡∏°‡∏µ</option>
                        </select>
                    </div>
                </div>

                <!-- New Product Section -->
                <div class="info-box">
                    <h4>‚ú® ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô</h4>
                </div>

                <div class="form-group">
                    <label>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà (‡∏ö‡∏≤‡∏ó)</label>
                    <input type="number" id="newProductPrice" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà">
                </div>

                <!-- Customer Information for Exchange -->
                <div class="info-box">
                    <h4>üë§ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h4>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</label>
                        <input type="text" id="exchangeCustomerName" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤">
                    </div>
                    <div class="form-group">
                        <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                        <input type="tel" id="exchangeCustomerPhone" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå">
                    </div>
                </div>

                <button class="calculate-btn" onclick="calculateExchange()">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>

                <div id="exchangeResult" class="result">
                    <h3>üîÑ ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
                    <div id="exchangeCalculationDetails" class="calculation-details">
                        <div id="exchangeCalculationSteps"></div>
                        <div id="exchangeFinalResult" class="final-price"></div>
                    </div>
                    <button class="save-btn" id="exchangeSaveBtn" onclick="saveExchangeToGoogleSheets()" disabled>
                        üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                    </button>
                </div>

                <div id="exchangeSuccessMessage" class="success-message">
                    ‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß!
                </div>

                <div id="exchangeErrorMessage" class="error-message">
                    ‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentCalculation = null;
        let currentExchangeCalculation = null;
        
        // Google Apps Script URL - ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢ URL ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£ Deploy
        // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: 'https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec'
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzHHpkupxUduvyTFUqBnnMhg3-uef8Qjp-MxbR0Q4iNBEyhKjD6B0Pv7VEckAGzAaw3/exec';
        
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
        }
        
        function toggleProductOptions() {
            const productType = document.getElementById('productType').value;
            const diamondOptions = document.getElementById('diamondOptions');
            const goldOptions = document.getElementById('goldOptions');
            
            if (productType === 'gold') {
                diamondOptions.style.display = 'none';
                goldOptions.style.display = 'block';
            } else {
                diamondOptions.style.display = 'block';
                goldOptions.style.display = 'none';
            }
        }
        
        function calculatePrice() {
            const branch = document.getElementById('branch').value;
            const productType = document.getElementById('productType').value;
            const condition = document.getElementById('condition').value;
            const warranty = document.getElementById('warranty').value;
            
            // Validate branch selection
            if (!branch) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }
            
            let basePrice = 0;
            let calculationSteps = [];
            
            if (productType === 'diamond') {
                const originalPrice = parseFloat(document.getElementById('originalPrice').value);
                
                if (!originalPrice || originalPrice <= 0) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                    return;
                }
                
                // Calculate based on price range
                let discountRate;
                if (originalPrice < 20000) {
                    discountRate = 0.5; // ‡∏´‡∏±‡∏Å 50%
                    calculationSteps.push(`‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô: ${originalPrice.toLocaleString()} ‡∏ö‡∏≤‡∏ó`);
                    calculationSteps.push(`‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ 20,000 ‡∏ö‡∏≤‡∏ó - ‡∏´‡∏±‡∏Å 50%`);
                } else {
                    discountRate = 0.3; // ‡∏´‡∏±‡∏Å 30%
                    calculationSteps.push(`‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô: ${originalPrice.toLocaleString()} ‡∏ö‡∏≤‡∏ó`);
                    calculationSteps.push(`‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏£‡∏≤‡∏Ñ‡∏≤ 20,000 ‡∏ö‡∏≤‡∏ó‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ - ‡∏´‡∏±‡∏Å 30%`);
                }
                
                basePrice = originalPrice * (1 - discountRate);
                calculationSteps.push(`‡∏£‡∏≤‡∏Ñ‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏´‡∏±‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î: ${basePrice.toLocaleString()} ‡∏ö‡∏≤‡∏ó`);
                
            } else if (productType === 'gold') {
                const goldWeight = parseFloat(document.getElementById('goldWeight').value);
                const goldWarranty = document.getElementById('goldWarranty').value;
                
                if (!goldWeight || goldWeight <= 0) {
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏ó‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                    return;
                }
                
                const pricePerGram = goldWarranty === 'with' ? 1500 : 1300;
                basePrice = goldWeight * pricePerGram;
                
                calculationSteps.push(`‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏ó‡∏≠‡∏á: ${goldWeight} ‡∏Å‡∏£‡∏±‡∏°`);
                calculationSteps.push(`‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏Å‡∏£‡∏±‡∏°: ${pricePerGram.toLocaleString()} ‡∏ö‡∏≤‡∏ó (${goldWarranty === 'with' ? '‡∏°‡∏µ' : '‡πÑ‡∏°‡πà‡∏°‡∏µ'}‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô)`);
                calculationSteps.push(`‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ê‡∏≤‡∏ô: ${goldWeight} √ó ${pricePerGram.toLocaleString()} = ${basePrice.toLocaleString()} ‡∏ö‡∏≤‡∏ó`);
            }
            
            // Apply condition adjustments
            let conditionMultiplier;
            switch (condition) {
                case 'A':
                    conditionMultiplier = 0.95;
                    calculationSteps.push(`‡∏™‡∏†‡∏≤‡∏û‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Å‡∏£‡∏î A (95%)`);
                    break;
                case 'B':
                    conditionMultiplier = 0.825; // Average of 70.1% and 94.9%
                    calculationSteps.push(`‡∏™‡∏†‡∏≤‡∏û‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Å‡∏£‡∏î B (82.5%)`);
                    break;
                case 'C':
                    conditionMultiplier = 0.7;
                    calculationSteps.push(`‡∏™‡∏†‡∏≤‡∏û‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Å‡∏£‡∏î C (70%)`);
                    break;
            }
            
            let finalPrice = basePrice * conditionMultiplier;
            calculationSteps.push(`‡∏£‡∏≤‡∏Ñ‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡∏™‡∏†‡∏≤‡∏û: ${basePrice.toLocaleString()} √ó ${(conditionMultiplier * 100)}% = ${finalPrice.toLocaleString()} ‡∏ö‡∏≤‡∏ó`);
            
            // Warranty bonus for jewelry (not applicable to gold K)
            if (productType === 'diamond' && warranty === 'yes') {
                finalPrice = finalPrice * 1.05; // 5% bonus
                calculationSteps.push(`‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô NGG (+5%): ${finalPrice.toLocaleString()} ‡∏ö‡∏≤‡∏ó`);
            }
            
            // Store calculation data
            currentCalculation = {
                branch: branch,
                productType: productType === 'diamond' ? 'Jewelry' : '‡∏ó‡∏≠‡∏á K',
                originalPrice: productType === 'diamond' ? parseFloat(document.getElementById('originalPrice').value) : null,
                goldWeight: productType === 'gold' ? parseFloat(document.getElementById('goldWeight').value) : null,
                goldWarranty: productType === 'gold' ? document.getElementById('goldWarranty').value : null,
                condition: condition,
                warranty: warranty,
                finalPrice: Math.round(finalPrice),
                calculationSteps: calculationSteps
            };
            
            // Display results
            document.getElementById('calculationSteps').innerHTML = 
                calculationSteps.map(step => `<div class="calculation-step">${step}</div>`).join('');
            document.getElementById('finalPrice').innerHTML = 
                `‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏±‡∏ö‡∏ã‡∏∑‡πâ‡∏≠‡∏Ñ‡∏∑‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢: <strong>${Math.round(finalPrice).toLocaleString()} ‡∏ö‡∏≤‡∏ó</strong>`;
            
            document.getElementById('result').classList.add('show');
            
            // Enable save button if customer info is filled
            checkSaveButtonStatus();
        }
        
        function checkSaveButtonStatus() {
            const customerName = document.getElementById('customerName').value.trim();
            const customerPhone = document.getElementById('customerPhone').value.trim();
            const saveBtn = document.getElementById('saveBtn');
            
            if (customerName && customerPhone && currentCalculation) {
                saveBtn.disabled = false;
            } else {
                saveBtn.disabled = true;
            }
        }
        
        // Add event listeners to customer info fields
        document.getElementById('customerName').addEventListener('input', checkSaveButtonStatus);
        document.getElementById('customerPhone').addEventListener('input', checkSaveButtonStatus);
        
        function saveToGoogleSheets() {
            const customerName = document.getElementById('customerName').value.trim();
            const customerPhone = document.getElementById('customerPhone').value.trim();
            
            if (!customerName || !customerPhone) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö');
                return;
            }
            
            if (!currentCalculation) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å');
                return;
            }
            
            const saveBtn = document.getElementById('saveBtn');
            const originalText = saveBtn.innerHTML;
            
            // Show loading
            saveBtn.innerHTML = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';
            saveBtn.disabled = true;
            
            // Prepare data for Google Sheets
            const data = {
                timestamp: new Date().toLocaleString('th-TH'),
                branch: currentCalculation.branch,
                customerName: customerName,
                customerPhone: customerPhone,
                productType: currentCalculation.productType,
                originalPrice: currentCalculation.originalPrice || '',
                goldWeight: currentCalculation.goldWeight || '',
                goldWarranty: currentCalculation.goldWarranty === 'with' ? '‡∏°‡∏µ‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô' : (currentCalculation.goldWarranty === 'without' ? '‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô' : ''),
                condition: currentCalculation.condition,
                warranty: currentCalculation.warranty === 'yes' ? '‡∏°‡∏µ' : '‡πÑ‡∏°‡πà‡∏°‡∏µ',
                finalPrice: currentCalculation.finalPrice,
                calculationDetails: currentCalculation.calculationSteps.join(' | ')
            };
            
            // Check if Google Apps Script URL is configured
            if (!GOOGLE_SCRIPT_URL || GOOGLE_SCRIPT_URL === 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE' || GOOGLE_SCRIPT_URL.trim() === '') {
                // Show configuration instructions
                setTimeout(() => {
                    document.getElementById('errorMessage').innerHTML = 
                        `‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Apps Script URL<br>
                        <small>üìã ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤:<br>
                        1. ‡∏™‡∏£‡πâ‡∏≤‡∏á Google Apps Script ‡πÉ‡∏´‡∏°‡πà<br>
                        2. Deploy ‡πÄ‡∏õ‡πá‡∏ô Web app<br>
                        3. ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å URL ‡∏°‡∏≤‡πÉ‡∏™‡πà‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î HTML<br>
                        4. ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE'</small>`;
                    document.getElementById('errorMessage').style.display = 'block';
                    
                    saveBtn.innerHTML = originalText;
                    saveBtn.disabled = false;
                    
                    setTimeout(() => {
                        document.getElementById('errorMessage').style.display = 'none';
                    }, 5000);
                }, 1000);
                return;
            }
            
            // Actual API call to Google Apps Script
            fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(() => {
                // Show success message
                document.getElementById('successMessage').style.display = 'block';
                
                // Reset form
                document.getElementById('customerName').value = '';
                document.getElementById('customerPhone').value = '';
                
                saveBtn.innerHTML = originalText;
                saveBtn.disabled = true;
                
                // Hide success message after 3 seconds
                setTimeout(() => {
                    document.getElementById('successMessage').style.display = 'none';
                }, 3000);
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('errorMessage').style.display = 'block';
                
                saveBtn.innerHTML = originalText;
                saveBtn.disabled = false;
                
                // Hide error message after 3 seconds
                setTimeout(() => {
                    document.getElementById('errorMessage').style.display = 'none';
        function toggleOldProductOptions() {
            const productType = document.getElementById('oldProductType').value;
            const oldDiamondOptions = document.getElementById('oldDiamondOptions');
            const oldGoldOptions = document.getElementById('oldGoldOptions');
            
            if (productType === 'gold') {
                oldDiamondOptions.style.display = 'none';
                oldGoldOptions.style.display = 'block';
            } else {
                oldDiamondOptions.style.display = 'block';
                oldGoldOptions.style.display = 'none';
            }
        }

        function calculateOldProductValue(productType, originalPrice, goldWeight, goldWarranty, condition, warranty) {
            let basePrice = 0;
            let calculationSteps = [];
            
            if (productType === 'diamond') {
                if (!originalPrice || originalPrice <= 0) {
                    return null;
                }
                
                let discountRate;
                if (originalPrice < 20000) {
                    discountRate = 0.5;
                    calculationSteps.push(`‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏î‡∏¥‡∏°: ${originalPrice.toLocaleString()} ‡∏ö‡∏≤‡∏ó`);
                    calculationSteps.push(`‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ 20,000 ‡∏ö‡∏≤‡∏ó - ‡∏´‡∏±‡∏Å 50%`);
                } else {
                    discountRate = 0.3;
                    calculationSteps.push(`‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏î‡∏¥‡∏°: ${originalPrice.toLocaleString()} ‡∏ö‡∏≤‡∏ó`);
                    calculationSteps.push(`‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏£‡∏≤‡∏Ñ‡∏≤ 20,000 ‡∏ö‡∏≤‡∏ó‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ - ‡∏´‡∏±‡∏Å 30%`);
                }
                
                basePrice = originalPrice * (1 - discountRate);
                calculationSteps.push(`‡∏£‡∏≤‡∏Ñ‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏´‡∏±‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î: ${basePrice.toLocaleString()} ‡∏ö‡∏≤‡∏ó`);
                
            } else if (productType === 'gold') {
                if (!goldWeight || goldWeight <= 0) {
                    return null;
                }
                
                const pricePerGram = goldWarranty === 'with' ? 1500 : 1300;
                basePrice = goldWeight * pricePerGram;
                
                calculationSteps.push(`‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏ó‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°: ${goldWeight} ‡∏Å‡∏£‡∏±‡∏°`);
                calculationSteps.push(`‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏Å‡∏£‡∏±‡∏°: ${pricePerGram.toLocaleString()} ‡∏ö‡∏≤‡∏ó (${goldWarranty === 'with' ? '‡∏°‡∏µ' : '‡πÑ‡∏°‡πà‡∏°‡∏µ'}‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô)`);
                calculationSteps.push(`‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ê‡∏≤‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏î‡∏¥‡∏°: ${goldWeight} √ó ${pricePerGram.toLocaleString()} = ${basePrice.toLocaleString()} ‡∏ö‡∏≤‡∏ó`);
            }
            
            // Apply condition adjustments
            let conditionMultiplier;
            switch (condition) {
                case 'A':
                    conditionMultiplier = 0.95;
                    calculationSteps.push(`‡∏™‡∏†‡∏≤‡∏û‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏î‡∏¥‡∏°‡πÄ‡∏Å‡∏£‡∏î A (95%)`);
                    break;
                case 'B':
                    conditionMultiplier = 0.825;
                    calculationSteps.push(`‡∏™‡∏†‡∏≤‡∏û‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏î‡∏¥‡∏°‡πÄ‡∏Å‡∏£‡∏î B (82.5%)`);
                    break;
                case 'C':
                    conditionMultiplier = 0.7;
                    calculationSteps.push(`‡∏™‡∏†‡∏≤‡∏û‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏î‡∏¥‡∏°‡πÄ‡∏Å‡∏£‡∏î C (70%)`);
                    break;
            }
            
            let finalPrice = basePrice * conditionMultiplier;
            calculationSteps.push(`‡∏£‡∏≤‡∏Ñ‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡∏™‡∏†‡∏≤‡∏û: ${basePrice.toLocaleString()} √ó ${(conditionMultiplier * 100)}% = ${finalPrice.toLocaleString()} ‡∏ö‡∏≤‡∏ó`);
            
            // Warranty bonus for jewelry
            if (productType === 'diamond' && warranty === 'yes') {
                finalPrice = finalPrice * 1.05;
                calculationSteps.push(`‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô NGG (+5%): ${finalPrice.toLocaleString()} ‡∏ö‡∏≤‡∏ó`);
            }
            
            return {
                finalPrice: Math.round(finalPrice),
                calculationSteps: calculationSteps
            };
        }

        function calculateExchange() {
            const branch = document.getElementById('exchangeBranch').value;
            const oldProductType = document.getElementById('oldProductType').value;
            const oldCondition = document.getElementById('oldCondition').value;
            const oldWarranty = document.getElementById('oldWarranty').value;
            const newProductPrice = parseFloat(document.getElementById('newProductPrice').value);
            
            // Validate inputs
            if (!branch) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤‡∏Å‡πà‡∏≠‡∏ô');
                return;
            }
            
            if (!newProductPrice || newProductPrice <= 0) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                return;
            }
            
            let oldProductValue = null;
            
            if (oldProductType === 'diamond') {
                const oldOriginalPrice = parseFloat(document.getElementById('oldOriginalPrice').value);
                oldProductValue = calculateOldProductValue(
                    'diamond', oldOriginalPrice, null, null, oldCondition, oldWarranty
                );
            } else if (oldProductType === 'gold') {
                const oldGoldWeight = parseFloat(document.getElementById('oldGoldWeight').value);
                const oldGoldWarranty = document.getElementById('oldGoldWarranty').value;
                oldProductValue = calculateOldProductValue(
                    'gold', null, oldGoldWeight, oldGoldWarranty, oldCondition, oldWarranty
                );
            }
            
            if (!oldProductValue) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏î‡∏¥‡∏°‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                return;
            }
            
            // Calculate exchange
            const processingFee = 500; // ‡∏Ñ‡πà‡∏≤‡πÅ‡∏õ‡∏£‡∏£‡∏π‡∏õ 500 ‡∏ö‡∏≤‡∏ó
            const oldValue = oldProductValue.finalPrice;
            const priceDifference = newProductPrice - oldValue;
            const totalAmount = priceDifference + processingFee;
            
            let calculationSteps = [...oldProductValue.calculationSteps];
            calculationSteps.push(`‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ`);
            calculationSteps.push(`‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà: ${newProductPrice.toLocaleString()} ‡∏ö‡∏≤‡∏ó`);
            calculationSteps.push(`‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏î‡∏¥‡∏°: ${oldValue.toLocaleString()} ‡∏ö‡∏≤‡∏ó`);
            calculationSteps.push(`‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤: ${newProductPrice.toLocaleString()} - ${oldValue.toLocaleString()} = ${priceDifference.toLocaleString()} ‡∏ö‡∏≤‡∏ó`);
            calculationSteps.push(`‡∏Ñ‡πà‡∏≤‡πÅ‡∏õ‡∏£‡∏£‡∏π‡∏õ: ${processingFee.toLocaleString()} ‡∏ö‡∏≤‡∏ó`);
            
            let resultText = '';
            let resultClass = '';
            
            if (totalAmount > 0) {
                resultText = `‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°: ${totalAmount.toLocaleString()} ‡∏ö‡∏≤‡∏ó`;
                resultClass = 'final-price';
                calculationSteps.push(`‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°: ${priceDifference.toLocaleString()} + ${processingFee.toLocaleString()} = ${totalAmount.toLocaleString()} ‡∏ö‡∏≤‡∏ó`);
            } else if (totalAmount < 0) {
                const refund = Math.abs(totalAmount);
                resultText = `‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏∑‡∏ô: ${refund.toLocaleString()} ‡∏ö‡∏≤‡∏ó`;
                resultClass = 'final-price';
                calculationSteps.push(`‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô: ${Math.abs(priceDifference).toLocaleString()} - ${processingFee.toLocaleString()} = ${refund.toLocaleString()} ‡∏ö‡∏≤‡∏ó`);
            } else {
                resultText = `‡πÄ‡∏™‡∏µ‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡πà‡∏≤‡πÅ‡∏õ‡∏£‡∏£‡∏π‡∏õ: ${processingFee.toLocaleString()} ‡∏ö‡∏≤‡∏ó`;
                resultClass = 'final-price';
                calculationSteps.push(`‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô - ‡πÄ‡∏™‡∏µ‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡πà‡∏≤‡πÅ‡∏õ‡∏£‡∏£‡∏π‡∏õ: ${processingFee.toLocaleString()} ‡∏ö‡∏≤‡∏ó`);
            }
            
            // Store calculation data
            currentExchangeCalculation = {
                branch: branch,
                oldProductType: oldProductType === 'diamond' ? 'Jewelry' : '‡∏ó‡∏≠‡∏á K',
                oldOriginalPrice: oldProductType === 'diamond' ? parseFloat(document.getElementById('oldOriginalPrice').value) : null,
                oldGoldWeight: oldProductType === 'gold' ? parseFloat(document.getElementById('oldGoldWeight').value) : null,
                oldGoldWarranty: oldProductType === 'gold' ? document.getElementById('oldGoldWarranty').value : null,
                oldCondition: oldCondition,
                oldWarranty: oldWarranty,
                oldProductValue: oldValue,
                newProductPrice: newProductPrice,
                priceDifference: priceDifference,
                processingFee: processingFee,
                totalAmount: totalAmount,
                calculationSteps: calculationSteps
            };
            
            // Display results
            document.getElementById('exchangeCalculationSteps').innerHTML = 
                calculationSteps.map(step => `<div class="calculation-step">${step}</div>`).join('');
            document.getElementById('exchangeFinalResult').innerHTML = 
                `<strong>${resultText}</strong>`;
            
            document.getElementById('exchangeResult').classList.add('show');
            
            // Enable save button if customer info is filled
            checkExchangeSaveButtonStatus();
        }

        function checkExchangeSaveButtonStatus() {
            const customerName = document.getElementById('exchangeCustomerName').value.trim();
            const customerPhone = document.getElementById('exchangeCustomerPhone').value.trim();
            const saveBtn = document.getElementById('exchangeSaveBtn');
            
            if (customerName && customerPhone && currentExchangeCalculation) {
                saveBtn.disabled = false;
            } else {
                saveBtn.disabled = true;
            }
        }

        // Add event listeners to exchange customer info fields
        document.getElementById('exchangeCustomerName').addEventListener('input', checkExchangeSaveButtonStatus);
        document.getElementById('exchangeCustomerPhone').addEventListener('input', checkExchangeSaveButtonStatus);

        function saveExchangeToGoogleSheets() {
            const customerName = document.getElementById('exchangeCustomerName').value.trim();
            const customerPhone = document.getElementById('exchangeCustomerPhone').value.trim();
            
            if (!customerName || !customerPhone) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö');
                return;
            }
            
            if (!currentExchangeCalculation) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å');
                return;
            }
            
            const saveBtn = document.getElementById('exchangeSaveBtn');
            const originalText = saveBtn.innerHTML;
            
            // Show loading
            saveBtn.innerHTML = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';
            saveBtn.disabled = true;
            
            // Prepare data for Google Sheets
            const data = {
                timestamp: new Date().toLocaleString('th-TH'),
                transactionType: '‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤',
                branch: currentExchangeCalculation.branch,
                customerName: customerName,
                customerPhone: customerPhone,
                oldProductType: currentExchangeCalculation.oldProductType,
                oldOriginalPrice: currentExchangeCalculation.oldOriginalPrice || '',
                oldGoldWeight: currentExchangeCalculation.oldGoldWeight || '',
                oldGoldWarranty: currentExchangeCalculation.oldGoldWarranty === 'with' ? '‡∏°‡∏µ‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô' : (currentExchangeCalculation.oldGoldWarranty === 'without' ? '‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô' : ''),
                oldCondition: currentExchangeCalculation.oldCondition,
                oldWarranty: currentExchangeCalculation.oldWarranty === 'yes' ? '‡∏°‡∏µ' : '‡πÑ‡∏°‡πà‡∏°‡∏µ',
                oldProductValue: currentExchangeCalculation.oldProductValue,
                newProductPrice: currentExchangeCalculation.newProductPrice,
                priceDifference: currentExchangeCalculation.priceDifference,
                processingFee: currentExchangeCalculation.processingFee,
                totalAmount: currentExchangeCalculation.totalAmount,
                calculationDetails: currentExchangeCalculation.calculationSteps.join(' | ')
            };
            
            // Check if Google Apps Script URL is configured
            if (!GOOGLE_SCRIPT_URL || GOOGLE_SCRIPT_URL === 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE' || GOOGLE_SCRIPT_URL.trim() === '') {
                setTimeout(() => {
                    document.getElementById('exchangeErrorMessage').innerHTML = 
                        `‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Apps Script URL<br>
                        <small>üìã ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤:<br>
                        1. ‡∏™‡∏£‡πâ‡∏≤‡∏á Google Apps Script ‡πÉ‡∏´‡∏°‡πà<br>
                        2. Deploy ‡πÄ‡∏õ‡πá‡∏ô Web app<br>
                        3. ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å URL ‡∏°‡∏≤‡πÉ‡∏™‡πà‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î HTML<br>
                        4. ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE'</small>`;
                    document.getElementById('exchangeErrorMessage').style.display = 'block';
                    
                    saveBtn.innerHTML = originalText;
                    saveBtn.disabled = false;
                    
                    setTimeout(() => {
                        document.getElementById('exchangeErrorMessage').style.display = 'none';
                    }, 5000);
                }, 1000);
                return;
            }
            
            // Actual API call to Google Apps Script
            fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(() => {
                // Show success message
                document.getElementById('exchangeSuccessMessage').style.display = 'block';
                
                // Reset form
                document.getElementById('exchangeCustomerName').value = '';
                document.getElementById('exchangeCustomerPhone').value = '';
                
                saveBtn.innerHTML = originalText;
                saveBtn.disabled = true;
                
                // Hide success message after 3 seconds
                setTimeout(() => {
                    document.getElementById('exchangeSuccessMessage').style.display = 'none';
                }, 3000);
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('exchangeErrorMessage').style.display = 'block';
                
                saveBtn.innerHTML = originalText;
                saveBtn.disabled = false;
                
                // Hide error message after 3 seconds
                setTimeout(() => {
                    document.getElementById('exchangeErrorMessage').style.display = 'none';
                }, 3000);
            });
        }
    </script>
</body>
</html>
